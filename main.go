package main

import (
	"fmt"
	"os"

	"github.com/kharism/golang-csg/core"
)

func main() {
	geometryBase := core.NewGeometry()
	// geometryBase.Position = []float64{-10, 10, 0, 10, 10, 0, 10, -10, 0}
	geometryBase.Position = []float64{1, 1, 1, 1, 1, -1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, 1, -1, -1, -1, -1, -1, 1, -1, 1, -1, 1, 1, -1, -1, 1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, -1, -1, -1, 1, -1, -1, -1, 1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, -1, 1, -1, 1, -1, -1, -1, -1, -1}
	// geometryBase.Index = []int32{0, 1, 2}
	geometryBase.Index = []int32{0, 2, 1, 2, 3, 1, 4, 6, 5, 6, 7, 5, 8, 10, 9, 10, 11, 9, 12, 14, 13, 14, 15, 13, 16, 18, 17, 18, 19, 17, 20, 22, 21, 22, 23, 21}
	// geometryBase.Normal = []float64{0, 0, 1, 0, 0, 1, 0, 0, 1}
	geometryBase.Normal = []float64{1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1}
	// geometryBase.UV = []float64{0, 0.5, 0, 0.5, 0, 0.5}
	geometryBase.UV = []float64{0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0}
	// geometryBase.Color = []float64{0, 1, 0, 0, 1, 0, 0, 1, 0}

	geometryBase.AddGroup(0, 6, 0)
	geometryBase.AddGroup(6, 6, 1)
	geometryBase.AddGroup(12, 6, 2)
	geometryBase.AddGroup(18, 6, 3)
	geometryBase.AddGroup(24, 6, 4)
	geometryBase.AddGroup(30, 6, 6)

	holes := core.NewGeometry()
	holes.Position = []float64{
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		0,
		1.2000000476837158,
		0,
		-0.45922011137008667,
		1.1086554527282715,
		0,
		-0.3247176706790924,
		1.1086554527282715,
		0.3247176706790924,
		-2.811912149484597e-17,
		1.1086554527282715,
		0.45922011137008667,
		0.3247176706790924,
		1.1086554527282715,
		0.3247176706790924,
		0.45922011137008667,
		1.1086554527282715,
		5.623824298969194e-17,
		0.3247176706790924,
		1.1086554527282715,
		-0.3247176706790924,
		8.435736779326036e-17,
		1.1086554527282715,
		-0.45922011137008667,
		-0.3247176706790924,
		1.1086554527282715,
		-0.3247176706790924,
		-0.45922011137008667,
		1.1086554527282715,
		-1.1247648597938388e-16,
		-0.8485281467437744,
		0.8485281467437744,
		0,
		-0.6000000238418579,
		0.8485281467437744,
		0.6000000238418579,
		-5.1957364944048306e-17,
		0.8485281467437744,
		0.8485281467437744,
		0.6000000238418579,
		0.8485281467437744,
		0.6000000238418579,
		0.8485281467437744,
		0.8485281467437744,
		1.0391472988809661e-16,
		0.6000000238418579,
		0.8485281467437744,
		-0.6000000238418579,
		1.5587208821470002e-16,
		0.8485281467437744,
		-0.8485281467437744,
		-0.6000000238418579,
		0.8485281467437744,
		-0.6000000238418579,
		-0.8485281467437744,
		0.8485281467437744,
		-2.0782945977619322e-16,
		-1.1086554527282715,
		0.45922011137008667,
		0,
		-0.7839377522468567,
		0.45922011137008667,
		0.7839377522468567,
		-6.788556805425921e-17,
		0.45922011137008667,
		1.1086554527282715,
		0.7839377522468567,
		0.45922011137008667,
		0.7839377522468567,
		1.1086554527282715,
		0.45922011137008667,
		1.3577113610851842e-16,
		0.7839377522468567,
		0.45922011137008667,
		-0.7839377522468567,
		2.0365669754533272e-16,
		0.45922011137008667,
		-1.1086554527282715,
		-0.7839377522468567,
		0.45922011137008667,
		-0.7839377522468567,
		-1.1086554527282715,
		0.45922011137008667,
		-2.7154227221703683e-16,
		-1.2000000476837158,
		7.347881115511007e-17,
		0,
		-0.8485281467437744,
		7.347881115511007e-17,
		0.8485281467437744,
		-7.347881115511007e-17,
		7.347881115511007e-17,
		1.2000000476837158,
		0.8485281467437744,
		7.347881115511007e-17,
		0.8485281467437744,
		1.2000000476837158,
		7.347881115511007e-17,
		1.4695762231022014e-16,
		0.8485281467437744,
		7.347881115511007e-17,
		-0.8485281467437744,
		2.2043642023044041e-16,
		7.347881115511007e-17,
		-1.2000000476837158,
		-0.8485281467437744,
		7.347881115511007e-17,
		-0.8485281467437744,
		-1.2000000476837158,
		7.347881115511007e-17,
		-2.939152446204403e-16,
		-1.1086554527282715,
		-0.45922011137008667,
		0,
		-0.7839377522468567,
		-0.45922011137008667,
		0.7839377522468567,
		-6.788556805425921e-17,
		-0.45922011137008667,
		1.1086554527282715,
		0.7839377522468567,
		-0.45922011137008667,
		0.7839377522468567,
		1.1086554527282715,
		-0.45922011137008667,
		1.3577113610851842e-16,
		0.7839377522468567,
		-0.45922011137008667,
		-0.7839377522468567,
		2.0365669754533272e-16,
		-0.45922011137008667,
		-1.1086554527282715,
		-0.7839377522468567,
		-0.45922011137008667,
		-0.7839377522468567,
		-1.1086554527282715,
		-0.45922011137008667,
		-2.7154227221703683e-16,
		-0.8485281467437744,
		-0.8485281467437744,
		0,
		-0.6000000238418579,
		-0.8485281467437744,
		0.6000000238418579,
		-5.1957364944048306e-17,
		-0.8485281467437744,
		0.8485281467437744,
		0.6000000238418579,
		-0.8485281467437744,
		0.6000000238418579,
		0.8485281467437744,
		-0.8485281467437744,
		1.0391472988809661e-16,
		0.6000000238418579,
		-0.8485281467437744,
		-0.6000000238418579,
		1.5587208821470002e-16,
		-0.8485281467437744,
		-0.8485281467437744,
		-0.6000000238418579,
		-0.8485281467437744,
		-0.6000000238418579,
		-0.8485281467437744,
		-0.8485281467437744,
		-2.0782945977619322e-16,
		-0.45922011137008667,
		-1.1086554527282715,
		0,
		-0.3247176706790924,
		-1.1086554527282715,
		0.3247176706790924,
		-2.811912149484597e-17,
		-1.1086554527282715,
		0.45922011137008667,
		0.3247176706790924,
		-1.1086554527282715,
		0.3247176706790924,
		0.45922011137008667,
		-1.1086554527282715,
		5.623824298969194e-17,
		0.3247176706790924,
		-1.1086554527282715,
		-0.3247176706790924,
		8.435736779326036e-17,
		-1.1086554527282715,
		-0.45922011137008667,
		-0.3247176706790924,
		-1.1086554527282715,
		-0.3247176706790924,
		-0.45922011137008667,
		-1.1086554527282715,
		-1.1247648597938388e-16,
		-1.4695762231022014e-16,
		-1.2000000476837158,
		0,
		-1.0391472988809661e-16,
		-1.2000000476837158,
		1.0391472988809661e-16,
		-8.998558396390371e-33,
		-1.2000000476837158,
		1.4695762231022014e-16,
		1.0391472988809661e-16,
		-1.2000000476837158,
		1.0391472988809661e-16,
		1.4695762231022014e-16,
		-1.2000000476837158,
		1.7997116792780743e-32,
		1.0391472988809661e-16,
		-1.2000000476837158,
		-1.0391472988809661e-16,
		2.699567739322302e-32,
		-1.2000000476837158,
		-1.4695762231022014e-16,
		-1.0391472988809661e-16,
		-1.2000000476837158,
		-1.0391472988809661e-16,
		-1.4695762231022014e-16,
		-1.2000000476837158,
		-3.5994233585561486e-32}

	holes.Index = []int32{
		0,
		9,
		10,
		1,
		10,
		11,
		2,
		11,
		12,
		3,
		12,
		13,
		4,
		13,
		14,
		5,
		14,
		15,
		6,
		15,
		16,
		7,
		16,
		17,
		10,
		9,
		19,
		9,
		18,
		19,
		11,
		10,
		20,
		10,
		19,
		20,
		12,
		11,
		21,
		11,
		20,
		21,
		13,
		12,
		22,
		12,
		21,
		22,
		14,
		13,
		23,
		13,
		22,
		23,
		15,
		14,
		24,
		14,
		23,
		24,
		16,
		15,
		25,
		15,
		24,
		25,
		17,
		16,
		26,
		16,
		25,
		26,
		19,
		18,
		28,
		18,
		27,
		28,
		20,
		19,
		29,
		19,
		28,
		29,
		21,
		20,
		30,
		20,
		29,
		30,
		22,
		21,
		31,
		21,
		30,
		31,
		23,
		22,
		32,
		22,
		31,
		32,
		24,
		23,
		33,
		23,
		32,
		33,
		25,
		24,
		34,
		24,
		33,
		34,
		26,
		25,
		35,
		25,
		34,
		35,
		28,
		27,
		37,
		27,
		36,
		37,
		29,
		28,
		38,
		28,
		37,
		38,
		30,
		29,
		39,
		29,
		38,
		39,
		31,
		30,
		40,
		30,
		39,
		40,
		32,
		31,
		41,
		31,
		40,
		41,
		33,
		32,
		42,
		32,
		41,
		42,
		34,
		33,
		43,
		33,
		42,
		43,
		35,
		34,
		44,
		34,
		43,
		44,
		37,
		36,
		46,
		36,
		45,
		46,
		38,
		37,
		47,
		37,
		46,
		47,
		39,
		38,
		48,
		38,
		47,
		48,
		40,
		39,
		49,
		39,
		48,
		49,
		41,
		40,
		50,
		40,
		49,
		50,
		42,
		41,
		51,
		41,
		50,
		51,
		43,
		42,
		52,
		42,
		51,
		52,
		44,
		43,
		53,
		43,
		52,
		53,
		46,
		45,
		55,
		45,
		54,
		55,
		47,
		46,
		56,
		46,
		55,
		56,
		48,
		47,
		57,
		47,
		56,
		57,
		49,
		48,
		58,
		48,
		57,
		58,
		50,
		49,
		59,
		49,
		58,
		59,
		51,
		50,
		60,
		50,
		59,
		60,
		52,
		51,
		61,
		51,
		60,
		61,
		53,
		52,
		62,
		52,
		61,
		62,
		55,
		54,
		64,
		54,
		63,
		64,
		56,
		55,
		65,
		55,
		64,
		65,
		57,
		56,
		66,
		56,
		65,
		66,
		58,
		57,
		67,
		57,
		66,
		67,
		59,
		58,
		68,
		58,
		67,
		68,
		60,
		59,
		69,
		59,
		68,
		69,
		61,
		60,
		70,
		60,
		69,
		70,
		62,
		61,
		71,
		61,
		70,
		71,
		64,
		63,
		73,
		65,
		64,
		74,
		66,
		65,
		75,
		67,
		66,
		76,
		68,
		67,
		77,
		69,
		68,
		78,
		70,
		69,
		79,
		71,
		70,
		80,
	}
	holes.Normal = []float64{
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		0,
		1,
		0,
		-0.3826834261417389,
		0.9238795042037964,
		0,
		-0.27059805393218994,
		0.9238795042037964,
		0.27059805393218994,
		-2.3432602348612458e-17,
		0.9238795042037964,
		0.3826834261417389,
		0.27059805393218994,
		0.9238795042037964,
		0.27059805393218994,
		0.3826834261417389,
		0.9238795042037964,
		4.6865204697224915e-17,
		0.27059805393218994,
		0.9238795042037964,
		-0.27059805393218994,
		7.029780539147615e-17,
		0.9238795042037964,
		-0.3826834261417389,
		-0.27059805393218994,
		0.9238795042037964,
		-0.27059805393218994,
		-0.3826834261417389,
		0.9238795042037964,
		-9.373040939444983e-17,
		-0.7071067690849304,
		0.7071067690849304,
		0,
		-0.5,
		0.7071067690849304,
		0.5,
		-4.329780301713277e-17,
		0.7071067690849304,
		0.7071067690849304,
		0.5,
		0.7071067690849304,
		0.5,
		0.7071067690849304,
		0.7071067690849304,
		8.659560603426554e-17,
		0.5,
		0.7071067690849304,
		-0.5,
		1.2989340243395341e-16,
		0.7071067690849304,
		-0.7071067690849304,
		-0.5,
		0.7071067690849304,
		-0.5,
		-0.7071067690849304,
		0.7071067690849304,
		-1.7319121206853109e-16,
		-0.9238795042037964,
		0.3826834261417389,
		0,
		-0.6532815098762512,
		0.3826834261417389,
		0.6532815098762512,
		-5.657130560897519e-17,
		0.3826834261417389,
		0.9238795042037964,
		0.6532815098762512,
		0.3826834261417389,
		0.6532815098762512,
		0.9238795042037964,
		0.3826834261417389,
		1.1314261121795038e-16,
		0.6532815098762512,
		0.3826834261417389,
		-0.6532815098762512,
		1.6971391682692557e-16,
		0.3826834261417389,
		-0.9238795042037964,
		-0.6532815098762512,
		0.3826834261417389,
		-0.6532815098762512,
		-0.9238795042037964,
		0.3826834261417389,
		-2.2628522243590076e-16,
		-1,
		6.123234262925839e-17,
		0,
		-0.7071067690849304,
		6.123234262925839e-17,
		0.7071067690849304,
		-6.123234262925839e-17,
		6.123234262925839e-17,
		1,
		0.7071067690849304,
		6.123234262925839e-17,
		0.7071067690849304,
		1,
		6.123234262925839e-17,
		1.2246468525851679e-16,
		0.7071067690849304,
		6.123234262925839e-17,
		-0.7071067690849304,
		1.8369701465288538e-16,
		6.123234262925839e-17,
		-1,
		-0.7071067690849304,
		6.123234262925839e-17,
		-0.7071067690849304,
		-1,
		6.123234262925839e-17,
		-2.4492937051703357e-16,
		-0.9238795042037964,
		-0.3826834261417389,
		0,
		-0.6532815098762512,
		-0.3826834261417389,
		0.6532815098762512,
		-5.657130560897519e-17,
		-0.3826834261417389,
		0.9238795042037964,
		0.6532815098762512,
		-0.3826834261417389,
		0.6532815098762512,
		0.9238795042037964,
		-0.3826834261417389,
		1.1314261121795038e-16,
		0.6532815098762512,
		-0.3826834261417389,
		-0.6532815098762512,
		1.6971391682692557e-16,
		-0.3826834261417389,
		-0.9238795042037964,
		-0.6532815098762512,
		-0.3826834261417389,
		-0.6532815098762512,
		-0.9238795042037964,
		-0.3826834261417389,
		-2.2628522243590076e-16,
		-0.7071067690849304,
		-0.7071067690849304,
		0,
		-0.5,
		-0.7071067690849304,
		0.5,
		-4.329780301713277e-17,
		-0.7071067690849304,
		0.7071067690849304,
		0.5,
		-0.7071067690849304,
		0.5,
		0.7071067690849304,
		-0.7071067690849304,
		8.659560603426554e-17,
		0.5,
		-0.7071067690849304,
		-0.5,
		1.2989340243395341e-16,
		-0.7071067690849304,
		-0.7071067690849304,
		-0.5,
		-0.7071067690849304,
		-0.5,
		-0.7071067690849304,
		-0.7071067690849304,
		-1.7319121206853109e-16,
		-0.3826834261417389,
		-0.9238795042037964,
		0,
		-0.27059805393218994,
		-0.9238795042037964,
		0.27059805393218994,
		-2.3432602348612458e-17,
		-0.9238795042037964,
		0.3826834261417389,
		0.27059805393218994,
		-0.9238795042037964,
		0.27059805393218994,
		0.3826834261417389,
		-0.9238795042037964,
		4.6865204697224915e-17,
		0.27059805393218994,
		-0.9238795042037964,
		-0.27059805393218994,
		7.029780539147615e-17,
		-0.9238795042037964,
		-0.3826834261417389,
		-0.27059805393218994,
		-0.9238795042037964,
		-0.27059805393218994,
		-0.3826834261417389,
		-0.9238795042037964,
		-9.373040939444983e-17,
		-1.2246468525851679e-16,
		-1,
		0,
		-8.659560603426554e-17,
		-1,
		8.659560603426554e-17,
		-7.498798786105971e-33,
		-1,
		1.2246468525851679e-16,
		8.659560603426554e-17,
		-1,
		8.659560603426554e-17,
		1.2246468525851679e-16,
		-1,
		1.4997597572211942e-32,
		8.659560603426554e-17,
		-1,
		-8.659560603426554e-17,
		2.2496396358317913e-32,
		-1,
		-1.2246468525851679e-16,
		-8.659560603426554e-17,
		-1,
		-8.659560603426554e-17,
		-1.2246468525851679e-16,
		-1,
		-2.9995195144423884e-32,
	}
	// holes.Color = []float64{0, 1, 0, 0, 1, 0, 0, 1, 0}
	holes.UV = []float64{
		0.0625,
		1,
		0.1875,
		1,
		0.3125,
		1,
		0.4375,
		1,
		0.5625,
		1,
		0.6875,
		1,
		0.8125,
		1,
		0.9375,
		1,
		1.0625,
		1,
		0,
		0.875,
		0.125,
		0.875,
		0.25,
		0.875,
		0.375,
		0.875,
		0.5,
		0.875,
		0.625,
		0.875,
		0.75,
		0.875,
		0.875,
		0.875,
		1,
		0.875,
		0,
		0.75,
		0.125,
		0.75,
		0.25,
		0.75,
		0.375,
		0.75,
		0.5,
		0.75,
		0.625,
		0.75,
		0.75,
		0.75,
		0.875,
		0.75,
		1,
		0.75,
		0,
		0.625,
		0.125,
		0.625,
		0.25,
		0.625,
		0.375,
		0.625,
		0.5,
		0.625,
		0.625,
		0.625,
		0.75,
		0.625,
		0.875,
		0.625,
		1,
		0.625,
		0,
		0.5,
		0.125,
		0.5,
		0.25,
		0.5,
		0.375,
		0.5,
		0.5,
		0.5,
		0.625,
		0.5,
		0.75,
		0.5,
		0.875,
		0.5,
		1,
		0.5,
		0,
		0.375,
		0.125,
		0.375,
		0.25,
		0.375,
		0.375,
		0.375,
		0.5,
		0.375,
		0.625,
		0.375,
		0.75,
		0.375,
		0.875,
		0.375,
		1,
		0.375,
		0,
		0.25,
		0.125,
		0.25,
		0.25,
		0.25,
		0.375,
		0.25,
		0.5,
		0.25,
		0.625,
		0.25,
		0.75,
		0.25,
		0.875,
		0.25,
		1,
		0.25,
		0,
		0.125,
		0.125,
		0.125,
		0.25,
		0.125,
		0.375,
		0.125,
		0.5,
		0.125,
		0.625,
		0.125,
		0.75,
		0.125,
		0.875,
		0.125,
		1,
		0.125,
		-0.0625,
		0,
		0.0625,
		0,
		0.1875,
		0,
		0.3125,
		0,
		0.4375,
		0,
		0.5625,
		0,
		0.6875,
		0,
		0.8125,
		0,
		0.9375,
		0,
	} //[]float64{0, 0.5, 0, 0.5, 0, 0.5}

	mesh1 := core.NewMesh(geometryBase)
	mesh2 := core.NewMesh(holes)

	// fmt.Println(len(geometryBase.UV), len(geometryBase.Position))
	// fmt.Println(len(holes.UV), len(holes.Position))

	csg1 := core.FromMesh(mesh1, nil)
	csg2 := core.FromMesh(mesh2, nil)

	// fmt.Println(len(csg1.Polygons))
	// fmt.Println(len(csg2.Polygons))

	// csg1.Polygons = csg1.Polygons[:2]

	// node1 := core.NewNode(csg1.Polygons)

	// fmt.Println(node1)

	csg3 := csg1.Subtract(csg2)
	// fmt.Println(csg3)
	//geom3 := core.ToGeometry(, mesh1.Matrix)
	geom3 := core.ToGeometry(csg3, mesh1.Matrix)
	//fmt.Println("DSDS", len(geom3.Position), len(geom3.Index))
	// geom3 := core.ToGeometry(csg3, nil)
	// fmt.Println(len(geom3.Position), len(geom3.Index))
	xx, _ := os.OpenFile("rr.obj", os.O_CREATE|os.O_RDWR, 0755)
	xx.WriteString(geom3.ToObj())
	xx.Close()

	raycaster := core.NewRaycaster(core.NewVector(0, 0, 20), core.NewVector(0, 0, -1))
	sqGeo := core.NewGeometry()
	sqGeo.Position = []float64{1, 1, 0, 1, -1, 0, -1, -1, 0, -1, 1, 0}
	sqGeo.Index = []int32{0, 1, 2, 2, 3, 0}
	meshX := core.NewMesh(sqGeo)
	intersections := raycaster.IntersectObject(meshX, true)
	fmt.Println(intersections)
}
